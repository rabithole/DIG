<div class="main-title">
	<h1>{{ section.settings.title }}</h1>
</div>
{% if block.settings.top-of-page %}
	<div class='top-bottom'>
		{{ section.settings.top-of-page }}
	</div>
{% endif %}

<!-- Top of kit page -->
<div class="kit" id=0>
	<h4 id=50 class="kitTotal"></h4>

	<!-- outside for loop -->
<<<<<<< HEAD
  	{% for block in section.blocks %}

	  	{% capture variants %}
			{{ block.settings.productOne }}
			{{ block.settings.productTwo }}
			{{ block.settings.productThree }}
			{{ block.settings.productFour }}
			{{ block.settings.productFive }}
			{{ block.settings.productSix }}
		{% endcapture %}

		{% assign variantsArray = variants | split: ' ' %}

	  		{% assign sku = block.settings.productOne %}
	  		{% assign prod = block.settings.product %}

	  		<!-- CANNOT CHANGE HTML OR IT WILL BREAK THE JAVASCRIPT -->
			<div class="product-container" id="{{ prod.handle }}">

			  	<section class="title-description">
			  		<h2 class="prod-title">{{ block.settings.title }}</h2>
			  		<p>{{ block.settings.description | truncate: 352 }}</p>
			  	</section>

			  	<section class="eachProduct">
				  	{% for option in prod.variants %}
		          		{% if option.sku == sku %}
		      				{% if prod.has_only_default_variant %}
		      					<img src='{{ block.settings.image | img_url }}' style='width: 200px;' class="product-image">
							{% else %}
								<img class="product-image" src='{{ option.image | img_url }}'> 
							{% endif %}

		            		<h3 class='product-price' id='{{ option.id }}' data-price={{ option.price }}>{{ option.price | money }}</h3>
		    				
							<div class="dropDown">
								<label for='variants'>Choose a hose</label>
								<select name="variants" class="variants-selector">
									{% for sku in variantsArray %}
										{% for title in prod.variants %}
											{% if title.sku == sku %}
												<option value={{ sku }}>{{ title.title }}</option>
											{% endif %}
										{% endfor %}
									{% endfor %}
								</select>
							</div>
						{% endif %}
				  	{% endfor %}
				</section> 

			</div>
=======
  {% for block in section.blocks %}
  		{% assign sku = block.settings.product_sku %}
  		{% assign prod = block.settings.product %}
  
		<div class="product-container">
	  	<section class="title-description">
	  		<h2 class="prod-title">{{ block.settings.title }}</h2>
	  		<p>{{ block.settings.description | truncate: 352 }}</p>
	  	</section>

	  	<section class="eachProduct">
		  	{% for option in prod.variants %}
          {% if option.sku == sku %}

      			{% if prod.has_only_default_variant %}
      				<img src='{{ block.settings.image | img_url }}' style='width: 200px;'>
						{% else %}
							<img src='{{ option.image | img_url }}' class="product-image">                                                                
    				{% endif %}

            	<h3 style="" id='{{ option.price }}' class='product-price'>{{ option.price | money }}</h3>

    				{% if option.title != 'Default Title' %}
            		<h2 class='product-model' id='{{ option.id }}'>{{ option.title }}</h2>
    				{% endif %}

          {% endif %}
		  	{% endfor %}



			</section> 
		</div>
>>>>>>> 2b78f7a78cfe57c0f77dd428836087c04b096493
  {% endfor %}
  <!-- end of outside for loop -->

  <div class='cart-button'>
      <button class="discount-page-button" >Add To Cart</button> 
  </div>

</div>
<!-- bottom of kit section -->

<<<<<<< HEAD
<div class='top-bottom'>
	{{ section.settings.bottom-of-page }}
</div>	

<script>
	var optionTitle = document.querySelectorAll('.product-container');
	var options = document.querySelectorAll('option');
	console.log('Option Title:---', optionTitle, 'Options:---', options)
=======

{% if block.settings.bottom-of-page %}
  <div class='top-bottom'>
      {{ section.settings.bottom-of-page }}
  </div>	
{% endif %}
<script>
// var changeProduct = function(e) {
// 	var select = document.getElementById('variants');
// 	var value = e.target.value;
// 	var sku = {{ sku }};

// 	console.log('sku', sku, {{ sku }}) 
// 	console.log('Product Sku', value)
// }

// var changeProduct = function(e) {
// 	var product = this.querySelectorAll('select');
// 	var index = product[0].selectedIndex;

// 	console.log('Index', index)

// 	var test = document.getElementById('testing');
// 	console.log('Test--- ', test)
// 	test.innerHTML = 'zero';
// 		// test.innerHTML = 'One, one, one';
// 	}



var addToCart = function(e) {
	var products = this.parentElement.querySelectorAll('H2.product-model')
	var productsData = [];

	products.forEach( function(product) {
	    productsData.push({
	        quantity: 1,
	        id: product.id
	    })
	})
>>>>>>> 2b78f7a78cfe57c0f77dd428836087c04b096493

	for(var i = 0; i < optionTitle.length; i++) {
		console.log('Option Title value:---', optionTitle[i].id)
	}
<<<<<<< HEAD

	// Setting id for each kit product section
=======
    console.log('Data', data)
debugger;
	fetch('/cart/add.js', {
	    body: JSON.stringify(data),
	    credentials: 'same-origin',
	    headers: {
	        'Content-Type': 'application/json'
	    },
	    method: 'POST'
	}).then((response) => {
	    response.json();
	    window.location.reload();
	}).then(data => {
	    console.log("Success", data)
	}).catch((err) => {
	    console.error(err)
	});
}

window.addEventListener('load', function(e) {
		console.log('event listener');
    Array.prototype.forEach.call(
        document.getElementsByClassName('dropDown'), function(element) {
            element.addEventListener('change', changeProduct)
            console.log(element)
        }
    );
});

window.addEventListener('load', function(e) {
    Array.prototype.forEach.call(
        document.getElementsByClassName('cart-button'), function(element) {
            element.addEventListener('click', addToCart)
        }
    );
});

>>>>>>> 2b78f7a78cfe57c0f77dd428836087c04b096493
    var kitID = document.getElementsByClassName('kit'); // used to set dynamic kit id
    var kitTotal = document.getElementsByTagName('h4'); // where total kit price will display
    var h3Tags = document.getElementsByTagName('h3'); // prices per product
    // console.log('h3 price tags:---', h3Tags)
    var price = 0;  
    var titlePriceId = 0; // Sets an arbitrary id for total section to match to each kit section
    var kitPriceArray = [];

    // Sets a unique id for each kit on the page.
    for(var i = 0; i < kitID.length; i++){
        kitID[i].id = i;
    }

    // Sets unique id for each kit total title.
    for(var j = 0; j < kitTotal.length; j++){
        var kitTotalId = kitTotal[j].id = 50 + j;
    }

	var updateKitTotal = function(){
		// Gathering prices of each product and totalling in the kit headline.
		kitPriceArray = []

		  for(var k = 0; k < h3Tags.length; k++) {

		    // grabs the 'KIT SECTION ID' from the h3Tags of h3 tags of product prices
		    // h3 parent nodes to get to section id's
		    var h3TagsID = Number(h3Tags[k].parentNode.parentNode.parentNode.id); 
		    // console.log('h3 tags id:---', h3TagsID)
		    
		    // grabs individual product prices from list of h3 tags containing product prices.
		    // h3 tags id's contain individual product prices
		    var productPrice = Number((h3Tags[k].dataset.price / 100).toFixed(2));
		    // console.log('product price:---', Number(productPrice))

		    if(h3TagsID == titlePriceId){
		        kitPriceArray.push(productPrice);
		    }else{
		        titlePriceId++
		        kitPriceArray = [];
		        kitPriceArray.push(productPrice);
		    }
		    // console.log('kit price array:---', kitPriceArray)

		    var sum = kitPriceArray.reduce(function (x,y){
		        return x + y;
		    }, 0)
		    
		    document.getElementById(kitTotalId).innerHTML = 'Total: ' + '$' + sum.toFixed(2);
		  }
	}

	updateKitTotal()

	// Grabs sku from drop down menu for selecting 
	var changeProduct = function(event) {
		var productHandle = event.target.closest('.product-container').id;
		var productImg = event.target.parentElement.parentElement.children[0];
		var productPriceElement = event.target.parentElement.parentElement.children[1];
		var sku = Number(event.target.value);
		productDetails(productHandle, sku, productImg, productPriceElement);
		
		var h3tags = document.getElementsByTagName('h3')
		// console.log('h3 tags:---', h3Tags, 'product price change:---', productPriceElement)
	}


	// Accessing store front api
	var productDetails = function(productHandle, sku, productImg, productPriceElement) {
		fetch(window.Shopify.routes.root + `products/${productHandle}.js`, {
		}).then((res) => {
				res.json().then(data => {
					// console.log('Product variants:---', data.variants)
					var variant = data.variants.find(objSku => {
						return objSku.sku == sku;
					});
					// console.log('Variant ID:---', variant.id, variant.price)

					// Product variant image
					productImg.src = variant.featured_image.src;

					// Product variant price
					productPriceElement.innerHTML = new Intl.NumberFormat('en-IN', {
						style: 'currency',
						currency: 'USD',
						maxiumumFractionDigits: -2
					}).format((variant.price /100).toFixed(2))

					productPriceElement.dataset.price = variant.price;

					productPriceElement.id = variant.id;
					updateKitTotal()
			})
		})
	}

	// Add to cart
	var addToCart = function(e) {
		var products = this.parentElement.querySelectorAll('H3.product-price')
		var productsData = [];

		products.forEach( function(product) {
			// console.log('products:---', product.id)
		    productsData.push({
		        quantity: 1,
		        id: product.id
		    })
		})

		var data = {
		    items: productsData
		}
		// console.log('Data', data)
	
		fetch('/cart/add.js', {
		    body: JSON.stringify(data),
		    credentials: 'same-origin',
		    headers: {
		        'Content-Type': 'application/json'
		    },
		    method: 'POST'
		}).then((response) => {
		    response.json();
		    window.location.reload();
		}).then(data => {
		    console.log("Success", data)
		}).catch((err) => {
		    console.error(err)
		});
	}

	window.addEventListener('load', function(e) {
	    Array.prototype.forEach.call(
	        document.getElementsByClassName('cart-button'), function(element) {
	            element.addEventListener('click', addToCart)
	        }
	    );

	    Array.prototype.forEach.call(
	        document.getElementsByClassName('variants-selector'), function(element) {
	            element.addEventListener('change', changeProduct)
	        }
	    );
	});
</script>

{% schema %}
	{
		"name": "Build A Kit",
		"tag": "div",
		"settings": [
			{	
				"id": "title",
				"type": "text",
				"label": "Kit Title"
			},
			{
				"type": "html",
				"label": "Kit details",
				"id": "top-of-page"
			},
			{
				"type": "html",
				"label": "More info",
				"id": "bottom-of-page"
			},
			{
				"type": "link_list",
				"id": "other-kits",
				"label": "Links to other kits"
			}
		],
		"blocks": [
			{
      "type": "text",
      "name": "product",
        "settings": [
        { 
          "id": "title",
          "type": "text",
          "label": "title"
        },
        {
          "type": "text",
          "id": "product_sku",
          "label": "Product Sku"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "id": "description",
          "type": "text",
          "label": "Product Description",
          "info": "Limit 350 charancters"
        },
        {
              "type": "image_picker",
              "id": "image",
              "label": "Use when there is only one variant for a product!",
              "info": "1200 x 800px .jpg recommended"
          }
  					]
				}
		],
		"presets": [
			{
				"category": "Product",
				"name": "Build A Kit",
				"settings": {}
			}
		]
	}
{% endschema %}

{% javascript %}
		



		
{% endjavascript %}




